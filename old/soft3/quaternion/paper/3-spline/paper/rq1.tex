\documentclass[11pt]{article} 
\usepackage{times}
\usepackage[pdftex]{graphicx}
\input{header-consecutive}

\setlength{\oddsidemargin}{0pt}
\setlength{\topmargin}{0in}
\setlength{\textheight}{8.6in}
\setlength{\textwidth}{6.875in}
\setlength{\columnsep}{5mm}
% \markright{Orientation control (\today) \hfill}
% \pagestyle{myheadings}

% -----------------------------------------------------------------------------
\title{Tech report 1: Quaternion splines for rational motion design}
% Johnstone and Williams
\begin{document}
\maketitle

{\bf Build a video of the rational quaternion spline technique.}

{\bf Work the software back up to snuff.}

\Comment{
% next paper: DUMB OR BLIND MOTION PLANNING (this strongly motivates rational motion):
% collision detection using the rational swept volumes generated by the rational motions;
% this would be a 'blind' replacement of the keen-sighted, or general, motion planner 
% proposed below, which incorporates the environment into its planning;
% dumb or blind in the sense that a motion is generated (with no knowledge of obstacles)
% and tested for collision, then regenerated
% based on the found collision and retested, etc.;  it is a valid strategy for local
% motions that are not expected to require large adjustments; the global motion, at a
% crude level, would be built by a different planner;
% required theoretical progress:
% 0) a rational motion is defined for a rigid object by interpolating 
% positions/orientations; these orientations are found how?
% 1) given a local motion for a rigid object, 

application: camera control through a scene, given certain desired viewpoints.
   i.e., you specify certain viewpoints in a scene from which to build a flythrough
   that hits certain cues
issue: camera is not an object like typical animations;
       however, orientation is a key input to a camera, and collision is well defined:
       position is the center of the back of the frustrum;
       orientation is the normal to the frustrum's back plane;
       bad camera configuration is one whose back plane of the viewing frustrum 
       intersects the scene (the side planes will almost always do so, with no
       ill effects)
source of positions: camera viewpoints at hit points
source of orientations: camera viewpoints at hit points
       only have to keep track of back plane of view frustrum: this makes possible
       a swept envelope approach, as follows.
Consider the back plane of the view frustrum moving through space with a moving camera.
We are interested in its intersections with the scene, which reflect ugly cutthroughs
of the scene in the rendering of the flythrough.
The four edges of the quadrilateral defining the back plane define four ruled surfaces
as they sweep through space.
These are rational ruled surfaces when the motion is rational.
We could consider the intersection of these four ruled surfaces with the scene,
but we can simplify further.
Suppose that the back plane of the view frustrum starts out in a free position,
not intersecting the scene.
Then one of its line segments can intersect the scene if and only if one of its vertices
(an endpoint of the line segment) intersects the scene.
Moreover, the vertex intersection detects the initial collision.
Therefore, it is sufficient to test the intersection of the four vertex curves
(the four rational curves defined by the motion of the four vertices of the back plane
of the view frustrum) with the scene.
Intersection points reveal collisions where the motion must be altered.

WE NEED THE RULED SURFACE INTERSECTION: object could interfere with frustrum edge without
interfering with frustrum vertex.
Therefore, think of ruled surface intersection methods.

In short, a camera path is safe iff the 4 rational endcurves of its view frustrum
backplane do not intersect the scene (where the camera starts out safe).

Think camera control in CSI, Final Fantasy.
Think automated motion planning through a virtual scene.

Ross reading:
       my quaternion spline papers
       * my Bezier curve software
       Bezier intersection papers, ruled surface intersection paper
       rational Bezier
       * introduction to robot motion (Latombe)
       give me game design examples, TV examples
       * build more architectural flythroughs
       what underlying data structure to store the scene?

Later challenges
       orientation planning with orientation constraints on camera
       high level motion algorithm (decomposition of scene into cells)

Initial challenges: 
            find realistic hit points 
                how close do they have to be to allow dumb interpolation rather than
		smart motion planning?
	    verify that motions generated from these keyframes are locally perturbable
	       to collision-free motions
            find 4 rational endcurves of view frustrum from position/orientation 

Flowchart: generation of flythrough -> collision detection -> path correction.
We could generate better paths by forcing paths down center of halls by shrinking
the corridors inward a set amount.  This shrinking could be removed if the path
correction gets too difficult.

followup paper:
How should the motion be altered when a collision is detected?
Once a collision is detected, there are several options to correct the motion.
As a first crack, assume that a small perturbation will correct the motion:
that is, the distance of our present path from a safe path is small.
If a collision is detected between keyframes i and i+1, we could perturb i,
we could perturb i+1, or we could add a new keyframe local to the collision.
We prefer the latter option, but there are various options here.
We will start by using the first collision only, and move perpendicular to the
present curve's tangent at this collision, which seems to correct in the best
direction to avoid a collision (we don't want to move in the present tangent direction).
The direction in this normal plane could be determined using which vertex of the four
back vertices has intersected: we could move within the normal plane 
towards the nonintersecting vertices.  
Alternatively, we could intersect the entire backplane quadrilateral with the scene
and determine a motion in this plane of the quadrilateral (which is also the normal plane)
that is guaranteed to remove collision.
Experiments with these approaches are necessary.

%
% future paper: ACTIVE ORIENTATION OBSTACLES
% design of quaternion splines that avoid active orientation obstacles
% (and the definition of these orientation obstacles using quaternion splines);
% an active orientation obstacle is an obstacle based on the movement of the robot,
% not on the environment, such as not spilling milk;
% 
% elaboration on this theme: PASSIVE ORIENTATION OBSTACLES AND INTELLIGENT PLANNING
% generation of collision-free motions, using
% passive orientation obstacles defined by the environment; this is harder
% and would solve a problem mentioned way back in Lozano-Perez
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Introduction}

The design of quaternion splines for motion design may be approached through
a two-step process, as follows.
Let $f$ be a map from Euclidean space (typically 3-space or 4-space) to $S^3$,
and let $Q$ be a set of quaternions.

\begin{itemize}
% \item Map the quaternions $Q$ under $f^{-1}$.
\item Build a curve C that interpolates $f^{-1}(Q)$.
\item Map the curve C under $f$, yielding a quaternion spline $f(C)$ 
      that interpolates $Q$, embedded in $S^3$.
\end{itemize}

The advantage of this approach is that it isolates the two challenges
of quaternion spline design, point interpolation and constraint to the 3-sphere.
The first step addresses the interpolation, while the second step addresses the constraint
to the 3-sphere.
Since the interpolation does not need to worry about the surface constraint, it can use
classical interpolation in free Euclidean space.
The map to the 3-sphere handles the surface constraint.
Another major advantage is that, if the map $f$ is rational, 
the quaternion spline is rational.

In an earlier paper, we solved one central challenge of this approach, 
the design of a rational map to the sphere.
In particular, a characterization of all rational maps from Euclidean $m$-space 
to the n-sphere was developed.
This companion paper continues on with the study of motion design,
and makes concrete the entire algorithm for the construction of rational 
quaternion splines.
In particular, the following problems are solved:
the choice of a particular rational map $f$ to \Sn{3},
the construction of the inverse $f^{-1}$ of this map,
techniques to map the quaternions $Q$ away from the poles of $f^{-1}$ (inherent to any
$f^{-1}$) before mapping,
% (which leads to the division of the large interpolation problem
% into several sub-interpolation problems),
the image of derivatives under $f^{-1}$ (demanded by the solution to pole avoidance),
% see p. 37 forward of hermiteQ.pdf
and the image of a Bezier curve under $f$.

\clearpage

\section{Quaternions and orientation}
\label{sec:quaternion}

Review of quaternions, quaternion sphere, and quaternion splines:
this is verbatim from 1999 technical report.

The unit quaternion is a preferred representation for the
orientation of a rigid object in computer animation.
The quaternion was invented by Hamilton in 1843
	% H. Coxeter, Non-Euclidean Geometry, Univ. of Toronto Press, 1961, p. 122
as a 4-dimensional generalization of complex numbers.
It was soon recognized that the quaternion can also be used
to represent an orientation.
To see this, we appeal to a fundamental result of Euler from 1752
\cite{goldstein50} (Figure~\ref{fig:eulerRotation}).	
	% goldstein, p. 118
	% also junkins, optimal spacecraft rotational maneuvers, p. 26
	% Cayley quickly realized the quaternion's use for rotation,
	% establishing a connection to the rotation matrix 
	% (see Coxeter, Non-Euclidean Geometry, p. 122).
\begin{theorem}[Euler]
A rigid body can be moved from an arbitrary initial orientation
to an arbitrary final orientation by a single rotation of the body
about a fixed axis.
\end{theorem}
%
% figure: fig:eulerRotation here
%
This shows that the orientation of a rigid body can be represented by 
a rotation axis $v$, $\|v\|=1$, and the rotation angle $\theta$ about 
this axis required to rotate the body into the given orientation from a
canonical orientation (say, the orientation in which the exact geometry
of the body was originally specified).
$v$ and $\theta$ are encoded in a unit quaternion by
$(\cos \frac{\theta}{2}, v \sin \frac{\theta}{2})$.
Notice that $v$ and $\theta$ can be easily extracted from this encoding.

The quaternion's representation of orientation has two great benefits.
First, since it is a unit vector, it can be interpreted geometrically
as a point on \Sn{3}.
Second, we can measure the amount of rotation using this geometric
interpretation, since the metric on \Sn{3}
is the same as the metric of the rotation group \cite{misner73}.
%
\begin{theorem}
\label{thm:metric}
The metrics on \Sn{3}\ and the rotation group SO(3) are equivalent.
	% That is, arc length on \Sn{3}\ is proportional (equivalent?) to
	% the (Frobenius norm?) of the associated rotation matrix.
\end{theorem}
%
In short, the speed of a body's rotation through 3-space
can be directly measured,
and directly controlled, through the length of the quaternion spline.
This is an important tool for motion control in animation or robotics.
	% For example, constant speed on quaternion spline yields
	% constant speed of rotation of the rigid body.

The rotation of an object by a quaternion need not be 
computed using its literal interpretation as rotation about an axis.
Quaternion algebra offers an easier solution, which we now review.
The quaternion $(a,b,c,d)$ is actually shorthand for $a + bi + cj + dk$,
where $i$, $j$ and $k$ satisfy the relationship 
	% generalizations of the imaginary unit $i$
\begin{equation}
\label{eq:ijk}
	i^2 = j^2 = k^2 = ijk = -1. 
\end{equation}
A quaternion $(a,b,c,d)$ is often expressed as a scalar component
and a vector component, $(s,v)$, where $s=a$ and $v=(b,c,d)$.
Using this notation and applying (\ref{eq:ijk}),
the formula for quaternion multiplication is
\begin{equation}
\label{eq:qmult}
	[s_1,v_1] * [s_2,v_2] =
	[s_1*s_2 - v_1 \cdot v_2,\ 
	 s_1 * v_2 + s_2 * v_1 + v_1 \times v_2]
\end{equation}
A point $p \in \Re^3$ is rotated by the unit quaternion $[s,v]$
to the point $[s,-v] * [0,p] * [s,v]$.
This is a quaternion, but it can be interpreted
as a point in 3-space since its scalar part is necessarily 0.
	% quaternions form a noncommutative division ring (ring whose nonzero elements
	% form a group under multiplication: Hernstein, p. 125

Mathematically, an orientation can be represented by either of two antipodal quaternions
(by flipping the rotation axis $v$).
That is, \Sn{3}\ is a double covering of SO(3).\footnote{A natural
	explanation for this double covering is provided by Dirac's belt trick,
	well developed in \cite{hart94}.}
However, when using quaternions for motion control, only one of the two
quaternion representations is appropriate in a given context:
the quaternion with the smaller angular gap on \Sn{3} to the previous quaternion.
This is true because a small angular gap between consecutive quaternions
creates less spinning than a large angular gap.
Consider the difference between a small rotation and the complementary
rotation that represents an almost complete pirouette.
If the designer's intent is to include the pirouette, then this should be
made explicit in the motion control by adding intermediate quaternions
that imply this spin.
A motion should not introduce spinning unless it is explicitly designed in.

The quaternion has several advantages over other representations
for orientation, such as the rotation matrix and Euler angles.
Unlike Euler angles, quaternions do not experience gimbal lock,
can be combined easily, and have an effectively unique representation
for each orientation.
Unlike rotation matrices, quaternions have a concise representation,
4 scalars rather than 9.\footnote{A quaternion is still slightly 
	larger than it needs to be since $v$, being a unit vector, 
	is fully determined by only 2 of its elements.
	That is, $v$ and $\theta$ could have been encoded in 
	a quaternion using only 3 scalars.
	However, the redundancy of 4 scalars is necessary for
	the quaternion's geometric interpretation on a unit sphere 
	and the metric equivalence of Theorem~\ref{thm:metric}.}
And unlike both Euler angles and rotation matrices, 
quaternions have a natural geometric interpretation through identification
with \Sn{3}, which is a crucial element in algorithmic development.

\clearpage

\section{Other definitions}

DEFINE BEZIER CURVE, BERNSTEIN POLYNOMIALS.
REVIEW RATIONAL BEZIER CURVE AND BEZIER CURVE IN PROJECTIVE SPACE,
PRODUCT RULE FOR BERNSTEIN POLYNOMIALS. 

\begin{defn2}
\Sn{n}\ is the unit sphere in $(n+1)$-space $x_1^2 + \ldots + x_{n+1}^2 - 1 = 0$,
a manifold of dimension $n$.
\end{defn2}

\begin{defn2}
A map $(x_1,\ldots,x_n) \mapsto (f_1 (x_1,\ldots,x_n),\ldots,f_m (x_1,\ldots,x_n))$
is {\bf rational} if 
the $f_i$ are all rational polynomials in $x_1,\ldots,x_n$, $i=1,\ldots,m$.
A {\bf rational polynomial} is a quotient of polynomials.
\end{defn2}

\begin{defn2}
\label{defn:projspace}
% We shall make use of projective space in some of the proofs in this paper.
Real {\bf projective $n$-space} $P^n$ is the space 
$\{ (x_1,x_2,\ldots,x_{n+1}) : x_i \in \Re, \mbox{not all zero} \}$
under the equivalence relation 
\begin{equation}
\label{eq:projequivalence}
(x_1,\ldots,x_{n+1}) = k(x_1,\ldots,x_{n+1}),\ \ k \neq 0 \in \Re.
\end{equation}
The point $(x_1,\ldots,x_{n+1})$ in projective $n$-space, $x_{n+1} \neq 0$,
is equivalent to the point $(\frac{x_1}{x_{n+1}},\ldots,\frac{x_n}{x_{n+1}})$
in $n$-space.
The point $(x_1,\ldots,x_n,0)$ in projective $n$-space represents the point
at infinity in the direction $(x_1,\ldots,x_n)$.
To translate from $n$-space to projective $n$-space, the point 
$(x_1,\ldots,x_n)$ is typically transformed into the point $(x_1,\ldots,x_n,1)$.
% See \cite{harris92} for more details on projective space.
\end{defn2}

% from hermiteQ.tex
{\bf Exposure sheet}

Maps to the sphere.
\[
	M(x_1,x_2,x_3,x_4) =
	\frac{1}{x_1^2 + x_2^2 + x_3^2 + x_4^2}
	(x_1^2 + x_2^2 + x_3^2 - x_4^2, 2x_1x_4, 2x_2x_4, 2x_3x_4)
\]
\[
SP^{-1}(x_1,x_2,x_3) = \frac{1}{x_1^2 + x_2^2 + x_3^2 + 1} 
                       (2x_1, 2x_2, 2x_3, x_1^2+x_2^2+x_3^2 - 1)
\]

Maps away from the sphere.
\[
M^{-1}|_{S3}(x_1,x_2,x_3,x_4) = \frac{1}{\sqrt{2(1-x_1)}}(x_2,x_3,x_4,1-x_1)
\]
\[
SP(x_1,x_2,x_3,x_4) = \frac{1}{1-x_4} (x_1,x_2,x_3)
\]

\clearpage

\section{Related work}
\label{sec:prevwork}

% THIS IS VERBATIM FROM SPLINE.TEX, THE 1999 TECHNICAL REPORT

INCLUDE REFERENCES IN REVIEW OF TOG PAPER.

There is a rich literature on quaternion splines.
\cite{shoemake85} introduced them as a solution 
for keyframe animation in 1985.
He used spherical linear interpolation (slerping) between points on \Sn{3}.
Many others have also used slerping 
\cite{duff85,pletinckx89,schlag91,nielson92,nielson93,kim95,nam95}.
The spherical linear interpolation between points $P_0$ and $P_1$ on $S^3$ is:
\[ P(t) = \frac{\sin((1-t)\theta) P_0 + \sin(t \theta) P_1}{\sin \theta}
\]
where $\cos \theta = P_0 \cdot P_1$.
This represents an arc of the great circle between $P_0$ and $P_1$.
The de Casteljau algorithm can be used to build traditional Bezier curves.
A spherical analog to the de Casteljau algorithm based upon
spherical linear interpolation is used to build quaternion splines,
mimicking Bezier \cite{shoemake85,kim95}, B-spline 
\cite{duff85,nielson92,nielson93,kim95}, Hermite \cite{kim95,nam95},
cardinal spline \cite{pletinckx89}, and Catmull-Rom \cite{schlag91} curves.
Since slerping is a nonrational operation,
all of the methods based on slerping generate nonrational curves.
Most of these curves are defined only by a geometric construction, and have
no closed form algebraic definition.
Computation of derivatives of these curves is complicated,
as is the imposition of $C^2$ continuity.
Kim et. al. \cite{kim95} provide solutions to the latter two problems,
using Lie algebra and its exponential map.
Our use of conventional Bezier or B-spline curves completely removes 
these problems with continuity or derivative calculation.
\cite{park97} again uses Lie algebra to design the quaternion spline,
working on the SO(3) manifold rather than the \Sn{3}\ manifold.

\cite{barr92} uses constrained optimization to develop optimal
quaternion splines, optimizing the constraint that the curve lie on \Sn{3}.
They also introduce low covariant acceleration
as a desirable property of a quaternion spline,
and incorporate it into their constraints.
This ability to incorporate extra constraints into the optimization
is a nice feature of their algorithm.
Their quaternion spline is nonrational with no closed-form expression,
and their numerical optimization can be expensive.
Their approach is refined for added efficiency in \cite{rama97}.

\cite{wang93, wang94} and \cite{nielson93} are close in spirit 
to this paper, since they design rational quaternion splines.
However, these curves are limited in scope.
\cite{wang93,wang94} and \cite{nielson93} develop quadratic curves
with $G^1$ continuity, and \cite{wang94} develops sextic curves
with $C^1$ continuity.
At least $C^2$ continuity is desirable, especially for animation.
	% In \cite{wang93,wang94}, the input points must be augmented with 
	% tangents, since the problem is posed as a Hermite interpolation problem.
The quaternion splines of \cite{wang93} are built from biarcs 
(great circles of the sphere), and those of \cite{nielson93} from circular arcs.
Both Wang and Nielson's methods also involve heuristic, data-dependent choices
that can be difficult to make,
such as the choice of a spherical biarc from
a one-parameter family of valid spherical biarcs, or a center of projection.
Our method generalizes the work of Wang and Nielson, 
by creating rational curves of arbitrary even degree 
(all rational curves on $S^3$ have even degree \cite{wang94}) 
and arbitrary continuity,
based on traditional NURBS and without any data-dependent choices.

The Euclidean-space approach has been used before
for the design of curves on surfaces \cite{dietz93,wang94}.
	% \cite{dietz93} and \cite{wang94} design rational curves on quadrics
	% in 3-space.
	% They both use a variant of the Euclidean-space approach.
The classical solution to the design of trim curves on a surface 
is another example, where the trim curve is designed in the parameter space 
of the surface and then mapped back to the surface using the
parameterization. % \cite{foley96}
Trim curves are not a good solution to quaternion splines, however.
It turns out that a parameterization of \Sn{3}\ is not a good map
to the surface for quaternion spline design (see Section~\ref{sec:results}).
Its domain is also wrong ($\Re^3$ rather than $\Re^4$) as discussed
in Sections~\ref{sec:intro} and~\ref{sec:eucdesign}.

\clearpage

\section{Rational maps to the 3-sphere}
\label{sec:map}

The first step in the design of a rational quaternion spline 
is the design of a good rational map from Euclidean space to the 3-sphere \Sn{3},
interpreted as the quaternion sphere.
This section explores two such maps.

\subsection{The Euler map to the sphere}

In an earlier paper \cite{jjrm0}, we completely characterized rational maps from
any Euclidean space to any sphere.
The main result was as follows.

\begin{theorem}
\label{thm:ratmap}
The map $f: \Re^m \rightarrow \Sn{n-1}$ is rational if and only if
it is of the following form (up to coordinate permutation):
\begin{equation}
\label{eq:re4s3}
% \footnotesize{(x_{\pi(1)},x_{\pi(2)},x_{\pi(3)},x_{\pi(4)})} \mapsto 
f(x_1,\ldots,x_m) = 
% \footnotesize{
(\frac{a_1^2 + \cdots + a_{n-1}^2 - a_n^2}{a_1^2 + \cdots + a_n^2},
	 \frac{2a_1a_n}{a_1^2 + \cdots + a_n^2},
	 \ldots, 
	 \frac{2a_{n-1}a_n}{a_1^2 + \cdots + a_n^2})
% }
\end{equation}
where $a_1,\ldots,a_n \in \Re[x_1,\ldots,x_m]$.
% and $\pi : \{1,2,3,4\} \rightarrow \{1,2,3,4\}$ is a permutation.
\end{theorem}

The most natural choice for the polynomials $a_i$ 
in Theorem~\ref{thm:ratmap} is $a_i = x_i$ and the identity permutation.
This yields the following map to the 3-sphere.
%
\begin{defn2}
The {\bf Euler map to the sphere} $M: \Re^4 - \{0\} \rightarrow \Sn{3}$ is defined by:
\begin{equation}
\label{eqM}
	M(x_1,x_2,x_3,x_4) =
	(\frac{x_1^2 + x_2^2 + x_3^2 - x_4^2}{x_1^2 + x_2^2 + x_3^2 + x_4^2},
	 \frac{2x_1x_4}{x_1^2 + x_2^2 + x_3^2 + x_4^2},
	 \frac{2x_2x_4}{x_1^2 + x_2^2 + x_3^2 + x_4^2},
	 \frac{2x_3x_4}{x_1^2 + x_2^2 + x_3^2 + x_4^2})
\end{equation}
%
If we let 
${\cal M}(p,q): = (p_1q_1 + p_2q_2 + p_3q_3 - p_4q_4, 2p_1q_4, 2p_2q_4, 2p_3q_4)$,
the Euler map may be re-expressed as:
\begin{equation}
\label{eq:calM}
M(P) = \frac{{\cal M}(P,P)}{P \cdot P}
\end{equation}
\end{defn2}

The Euler map has both bilinear and quadratic characteristics:
every coordinate of ${\cal M}$ is a bilinear map,
but in projective space, every coordinate of $M$ is a quadratic form.
% The form (\ref{eq:calM}) is valuable in Theorem~\ref{thm:imagecurve} below.

\subsection{Stereographic injection}

The most well-known map from the sphere is stereographic projection,
and another good rational map to the sphere may be built from it.
Stereographic projection, which has been used at least since Hipparch in 160 B.C. 
\cite{kreyszig59}, % p. 205
  % probably discovered by Hipparch too
is a map from \Sn{n}\ to the hyperplane $x_{n+1}=0$,
in which a point of \Sn{n}\ is perspectively projected from 
the north pole of \Sn{n}\ to $x_{n+1}=0$  % \cite{thorpe79}. % or kreyszig59
(Figure~\ref{fig:stereo}).
% Note that there is a variant of stereographic projection where
% the projection plane $z=0$ is replaced by the tangent plane opposite the pole
% $z=-1$ \cite{kreyszig59}.
Since stereographic projection is one-to-one and onto, it has a well-defined inverse,
which is a rational map from the hyperplane $x_{n+1}=0$
(interpreted as Euclidean $n$-space)
% (an embedding of n-space in $\Re^{n+1}$) 
to \Sn{n}.

% figure fig:stereo

\begin{lemma}
Stereographic projection 
$f_{SP}: \Sn{n} - (0,\ldots,0,1) \rightarrow x_{n+1}=0 \subset \Re^{n+1}$ 
is defined by:
\begin{eqnarray*}
f_{SP}(x_1,\ldots,x_{n+1}) & = & \frac{1}{1-x_{n+1}} (x_1,\ldots,x_n,0) \\
\end{eqnarray*}	% see thorpe79, p. 125
Its inverse map $f_{SP}^{-1}: x_{n+1}=0 \rightarrow \Sn{n} - (0,\ldots,0,1)$ 
is defined by:
\begin{eqnarray*}
f_{SP}^{-1}(x_1,\ldots,x_n,0) & = &
	\frac{1}{x_1^2 + \cdots + x_n^2 + 1} 
	(2x_1, \ldots, 2x_n, x_1^2 + \cdots + x_n^2 - 1)
\end{eqnarray*}	% see thorpe79, p. 125
\end{lemma}
\vspace{.1in}
\prf
The projector line $(1-t)p + tq$ through $p = (0,\ldots,0,1)$ and 
$q = (x_1,\ldots,x_{n+1}) \in \Sn{n}$ intersects $x_{n+1}=0$ 
when $1-t + tx_{n+1} = 0$ or $t = \frac{1}{1-x_{n+1}}$.
This defines stereographic projection.
For the inverse map, the projector line $(1-t)p + t(r,0)$ through $p = (0,\ldots,0,1)$ 
and $(r,0)$ intersects \Sn{n} when $\|(1-t)(0,\ldots,0,1) + t(r,0)\|^2 = 1$,
% or $(1-t)^2 + t^2\|r\|_2^2 = 1$,
or $t^2(\|r\|^2 + 1) = 2t$, or 
$t=0,\frac{2}{\|r\|^2 + 1}$.
The second root yields the inverse point.
\QED

Note that the image of the north pole $(0,\ldots,0,1)$ under stereographic projection
is well defined in projective space, where it is the line at infinity of the hyperplane.

\Comment{
Some other properties of the stereographic projection are interesting, although
more relevant to cartography than to our study.
It is a conformal map and, like any conformal map of \Sn{2}\ to the plane,
it maps loxodromes (curves of constant direction on the sphere) to straight lines.
It is the only conformal map from $S^2$ to a plane that preserves
circles (circles are mapped to circles or straight lines).
}

% By rotation, we can easily generalize to a rational map from $\Re^n$
% to $\Sn{n} - \{q\}$, where $q$ is an arbitrary point of \Sn{n}
	% by choosing a different center of
	% projection on \Sn{n}, say $q$, and projecting onto the associated hyperplane:
	% the hyperplane through the origin and parallel to $q$'s tangent plane.
	% This is simply a rotation of the conventional stereographic projection map.
% whose choice dictates the hyperplane embedding of $\Re^n$ in $\Re^{n+1}$.
The following version of the inverse map, which we shall use in this paper, 
results from rotating the pole to $(1,0,\ldots,0)$ and the projection plane 
to $x_1=0$.\footnote{This makes the pole agree with the pole of the Euler map,
                     $(1,0,\ldots,0)$, for added consistency.}

\begin{defn2}
\label{defn:si}
{\rm 
{\bf Stereographic injection} is the map 
% $\sigma^{-1}_{(1,0,\ldots,0)}: x_{1}=0 \rightarrow \Sn{n} - (1,0,\ldots,0)$:
% \begin{equation}
% \label{eq:injection}
% (0,x_1,\ldots,x_n) \mapsto
% 	\frac{1}{x_1^2 + \cdots + x_n^2 + 1} 
%	(x_1^2 + \cdots + x_n^2 - 1, 2x_1, \ldots, 2x_n)
% \end{equation}
$\sigma^{-1}: \Re^n \rightarrow \Sn{n} - (1,0,\ldots,0)$:
\begin{equation}
\label{eq:si}
(x_1,\ldots,x_n) \mapsto
	\frac{1}{x_1^2 + \cdots + x_n^2 + 1} 
	(x_1^2 + \cdots + x_n^2 - 1, 2x_1, \ldots, 2x_n)
\end{equation}
}
\end{defn2}

\Comment{
The standard rational parameterization of \Sn{n}\ 
can be developed from stereographic injection.

Since stereographic injection is a one-to-one, 
(almost) onto map from an $n$-dimensional
hyperplane to the $n$-dimensional sphere, 
it induces a parameterization of the sphere.
For example, in the case of \Sn{3}, this parameterization is:
\begin{equation}
	S(t_1,t_2,t_3) = 
	\frac{1}{t_1^2 + t_2^2 + t_3^2 + 1} 
	(2t_1, 2t_2, 2t_3, t_1^2 + t_2^2 + t_3^2 - 1) \ \ \ \ t_i \in (-\infty,\infty)
\end{equation}
% For the circle \Sn{1}, this parameterization is a variant of the
% classical $(\frac{1-t^2}{1+t^2}, \frac{2t}{1+t^2})$.
}

Stereographic injection is very similar to the rational map of $\Re^{n+1}$ to
\Sn{n}\ in Theorem~\ref{thm:ratmap} generated by the choice 
$(a_1,\ldots,a_{n+1}) = (x_1,\ldots,x_{n},1)$ and the identity permutation:
%
\begin{equation}
\label{eq:rat1}
(x_1,\ldots,x_{n+1}) \mapsto 
	\frac{1}{x_1^2 + \cdots + x_{n}^2 + 1}
	(x_1^2 + \cdots + x_{n}^2 - 1,
	 2x_1, \ldots, 2x_{n})
\end{equation}
%
Since every hyperplane $x_{n+1}=k$ of (\ref{eq:rat1}) gets mapped like 
(\ref{eq:si}), this is a many-to-one map with many embedded copies of
stereographic injection.
(\ref{eq:rat1}) will be called {\bf embedded stereographic injection}.

As we develop the rational quaternion spline, we shall use the two rational maps,
Euler map and stereographic injection, to illustrate the steps.
However, other rational maps may be used.

\clearpage

\section{Inverse maps away from the 3-sphere}

The second step in the construction of a quaternion spline is defining
the inverse of a rational map to the sphere,
which is used to map the quaternions off the sphere.
We consider the inverse of the Euler map and stereographic injection.

\subsection{Inverse of stereographic injection}

The inverse of stereographic injection is, of course, stereographic projection.
Recall from Definition~\ref{defn:si} that we are using a version of stereographic 
projection that maps to $x_1=0$, $f_{SP}:S^n - (1,0,0,0) \rightarrow x_1=0$:
\begin{equation}
\label{eqn:projection}
f_{SP}(x_1,x_2,x_3,x_4) = \frac{1}{1-x_1}(0,x_2,x_3,x_4)  % correct
\end{equation}
Notice that this inverse map is undefined at the pole $(1,0,0,0)$
(or, in projective space, it is simply unusual, mapping to the entire line at infinity, 
a line rather than a point).
The application of stereographic projection to the quaternions maps them off 
the sphere.
A curve is then interpolated through the inverse images, unconstrained to the sphere.
This is a simple result because the inverse is known and the inverse image of a point
is a point.
The use of the Euler map is a bit more complicated.

\subsection{Inverse of the Euler map}
\label{sec:inveuler}

Since the Euler map transforms 4-space into a 3-manifold,
the inverse of a typical point is a 1-manifold.

\begin{lemma}
\label{lem:inverse}
The inverse of the Euler map $M^{-1}: \Sn{3} \rightarrow \Re^4$ 
is defined by:
\begin{equation}
M^{-1}(x_1,x_2,x_3,x_4) = (1-t)(0,0,0,0) + t(x_2,x_3,x_4,1-x_1), t \in \Re, t \neq 0
\end{equation}
That is, the image of a point is a line through the origin
and $(x_2,x_3,x_4,1-x_1)$.
The map has a special behaviour at the pole $(1,0,0,0)$:
\begin{equation}
\label{eqn:eulerpole}
M^{-1}(1,0,0,0) = \mbox{ the hyperplane $x_4=0$ without the origin}
\end{equation}
\end{lemma}
\prf 
See the appendix.
\QED

% Example of another map: using $a_1=x_1 - 1$, $a_2 = x_2^2$, $a_3=0$, 
% and $a_4=x_4$,
% let $M(q_1,q_2,q_3,q_4,q_5) = (q_1^2 - 2q_1 + 1 + q_2^4 - q_4^2,
% 				2q_1q_4 - 2q_4, 2q_2^2 q_4, 0, 
% 				q_1^2 - 2q_1 + 1 + q_2^4 + q_4^2)$.

Application of the inverse Euler map to the quaternions $\{q_i\}$ again maps them 
off the sphere, where interpolation can be implemented without concern about
constraint to the sphere.
However, the inverse image of a point is now a line.
Since interpolation of lines is largely unexplored,
it would be more natural to reduce the line interpolation to point 
interpolation.
{\bf Explore interpolation of lines, which also arises in tangential curves.}
This can be done simply by choosing a point on each line.
A natural solution is to choose the closest point on each line to the previous point:
if $p_i$ is the point chosen on $M^{-1}(q_i)$, $p_i$ is the closest point to $p_{i-1}$.
(The first point can be chosen arbitrarily, perhaps on \Sn{3}.)
This promotes shorter curves in Euclidean space, which promotes shorter quaternion 
splines,\footnote{Curve length in Euclidean space is not equivalent to curve length
  of the associated quaternion spline.
  For example, in the extreme case, motion along
	an inverse line $M^{-1}(q_i)$ in $\Re^4$ causes no associated
	motion on \Sn{3}.  However, in general, the arc length
	of the two curves, one in Euclidean space and the other on \Sn{3},
	is strongly related.
	Moreover, the avoidance of motion in Euclidean space always leads 
	to the avoidance of motion on \Sn{3}.}
which discourages unnecessary spinning
of the moving object, since there is a direct relationship between length on \Sn{3} and 
amount of rotation (the metric of \Sn{3} is the same as the metric of the 
rotation group $SO(3)$ \cite{misner73}).
However, there is one problem with this choice: the points $p_i$ 
will spiral in towards the origin, because all the inverse lines pass through the origin
and grow closer together there.
This could be a problem since the Euler map is undefined at the origin;
moreover, the points get very close together.
An excellent alternative is to choose the point of $M^{-1}(q_i)$ on \Sn{3}.
This is a good approximation to the closest point, especially when the quaternions
are densely sampled.
(The appendix develops a formula for the distance of the point on \Sn{3}\ from
the closest point as a function of the angular distance between the associated
quaternions, which formally establishes the quality of this approximation.)
By choosing the point of \Sn{3} on the inverse line, the following inverse map results.
%
\begin{defn2}
The {\bf restricted inverse Euler map} $M^{-1}_{S3}: S^3 - \{(1,0,0,0)\} \rightarrow S^3$,
defined by $M^{-1}_{S3}(P) = M^{-1}(P) \nolinebreak \cap \nolinebreak S^3$, has the form
\begin{equation}
(x_1,x_2,x_3,x_4) \mapsto \frac{1}{\sqrt{2-2x_1}}(x_2,x_3,x_4,1-x_1)
\end{equation}
\end{defn2}
%
To see this, note that $\frac{(x_2,x_3,x_4,1-x_1)}{\|x_2,x_3,x_4,1-x_1\|}$ is
an intersection of the inverse line with $S^3$, and
\[
\|(x_2,x_3,x_4,1-x_1)\|^2 = x_2^2 + x_3^2 + x_4^2 + (1-x_1)^2
= x_1^2 + x_2^2 + x_3^2 + x_4^2 + 1 - 2x_1 = 2 - 2x_1.
\]
% Since $(x_1,x_2,x_3,x_4) \in S^3$,
% \[
% \|(x_2,x_3,x_4,1-x_1)\|_2^2 = 2 - 2x_1
% \]
%
This inverse map is very simple, defines a map from \Sn{3} to \Sn{3},
avoids the problematic origin, and promotes short quaternion splines.
% Note that this is a well-defined choice, since $M^{-1}(P)$ is a line through the origin.

% It is a map from $S^3$ to $S^3$.
% This is not a rational map, but it need not be.

{\bf Image of quaternions on sphere, their inverse images as lines, their inverse images
as points.}

\Comment{
\begin{defn2}
\label{defn:pole}
The special point $(1,0,0,0)$ is called the {\bf pole} of the map $M^{-1}$.
$(x_2,x_3,x_4,1-x_1)$ is called the {\bf defining point} of the preimage 
$M^{-1}(x_1,x_2,x_3,x_4)$.
\end{defn2}

\noindent Notice the beautiful simplicity of the defining point.
}

\subsection{General inverse map}

One might hope for a general inverse map, the inverse of the general 
rational map to the sphere (\ref{eq:re4s3}).
Unfortunately, the proof technique of Lemma~\ref{lem:inverse}
requires working in projective space, 
% works for any individual map, but it
so it cannot be applied to the abstract general map (\ref{eq:re4s3})
to reveal the general inverse map.
To work in projective space
% to take advantage of the extra equation it offers;
would require getting inside the arbitrary polynomials
$a_i$ of (\ref{eq:re4s3}) to translate them into projective space,
an infeasible task since these polynomials are of unknown and varying degree.
However, the proof technique does work for any {\em particular} choice of rational
map to the sphere, so there is full flexibility in applying this technique
using any rational map to the sphere.

\clearpage

\section{Avoiding the pole of the 3-sphere}
\label{sec:pole}

This section considers the issue of poles.
Notice that both stereographic projection (\ref{eqn:projection}) 
and the inverse Euler map (\ref{eqn:eulerpole}) have poles.
A pole is an inevitable artifact of the inverse of a rational map to the sphere, 
as discussed in \cite{jjrm0}.
Before the quaternions $\{q_i\}$ are mapped by an inverse map,
they need to be perturbed away from the pole of that inverse map,
since the inverse maps are not well behaved near their poles.
This section is structured as follows.
We first discuss the problems associated with quaternions near the pole 
(Section~\ref{sec:behaviour}), then the issue of coordinate frame invariance
of our quaternion spline under rotation (Section~\ref{sec:invariance}).
Section~\ref{sec:polerotate} discusses the actual rotation away from the pole.
Finally, a divide and conquer strategy (Section~\ref{sec:divide}) is suggested by one 
of the methods for rotating the quaternions away from the pole.
This motivates the treatment of derivatives in Section~\ref{sec:deriv}.

START HERE

\subsection{Behaviour near the pole}
\label{sec:behaviour}

Consider the inverse Euler map $M^{-1}$ with its pole $(1,0,0,0)$ as an example.
Lemma~\ref{lem:inverse} established that the 
image of a point $p = (x_1,x_2,x_3,x_4) \neq (1,0,0,0)$ is a line through the
origin and the defining point $(x_2,x_3,x_4,1-x_1)$.
As $p \in \Sn{3}$ approaches the pole $(1,0,0,0)$,
the defining point of the line approaches the origin.
% \[ 
% \mbox{lim}_{(x_1,x_2,x_3,x_4) \rightarrow (1,0,0,0)} (x_2,x_3,x_4,1-x_1)
% = (0,0,0,0) 
% \]
Consequently, the line becomes ill-conditioned:
% the defining point becomes an ill-conditioned specification of $M^{-1}(p)$:
small motions of $p$ can cause large motions of $M^{-1}(p)$.
% \footnote{This 
%  is analogous to the solution of a linear
%  system when the condition number of the matrix becomes large,
%  and the linear system becomes very sensitive to perturbation of the matrix.}
The following example illustrates.

\begin{example}
If $p$ on \Sn{3}\ is at distance $d$ from the pole,
the defining point of $M^{-1}(p)$ is also at distance $d$ from the
origin.
Then a motion of $d+\epsilon$ of $p$ (corresponding to a motion
of the defining point directly towards the origin) can yield
a 90-degree change of orientation of the line $M^{-1}(p)$.
\end{example}

Since there is little correspondence 
between the position of $p$ and $M^{-1}(p)$ near the pole,
quaternion splines built out of quaternions near the pole will jump wildly about the pole 
or create cusps (Figure~\ref{fig:wild}).
We conclude that the quaternions must be moved away from the pole.
Experimental evidence indicates that a point $p \in \Sn{3}$ is far enough from 
the pole $P$ if the angle formed by the vectors $p$ and $P$ is larger than 20 degrees
({\bf or is it 30 degrees?}).
% used to be 30 degrees, but calculations below about existence of an empty region
% use 20 degrees so we must have determined that this is far enough 
% pi/6 radians
% Experimental evidence indicates that points closer to the pole 
% can lead to undesirable behaviour in the curve.
% 30 = PI/6; PI/7 is definitely too small (lowerbound), as witnessed by data5-1
% using TOOCLOSEDIST = PI/7;
% we have not found an example that is not treated well by PI/6.

% \begin{example}
% data5-1 using $\pi/7$ vs. $\pi/6$.
% \end{example}

% figure fig:wild

\Comment{
Another way of seeing this ill-conditioning is by observing the behaviour
of $M$ near the origin.
$M$ is undefined at the origin, due to the division by zero.
However, $M$ is also badly behaved {\bf near} the origin.
For example, consider approaching near the origin along the line $(0,0,t,.01)$.
In moving the short distance from $(0,0,.01,.01)$ to $(0,0,0,.01)$, 
the image under $M$ moves all the way from $(0,0,0,1)$ to $(-1,0,0,0)$.
That is, a move of distance $.01$ in $\Re^4$ maps to a move of angular distance
$\frac{\pi}{2}$ on \Sn{3}.
The portion of a curve in $\Re^4$ that is near the origin
will be stretched as it is mapped under $M$.
This is not desirable, as shown in Figure~\ref{fig:tooCloseToPole}.

This is not quite as strong or direct an argument for ill-conditioning as the previous
argument, since there is nothing forcing the user to use preimage points 
near the origin.
However, notice that if you do not stay close to the origin, 
then the large changes in the line with small changes on \Sn{3} mean that 
small distances on \Sn{3} will be filled by long curves (and thus not optimal
geodesics) since the preimage curve will be necessarily long.
}

\clearpage

\subsection{Invariance under rotation}
\label{sec:invariance}

To avoid degeneracies associated with the pole, all quaternions 
will be rotated away from the pole before design of the quaternion spline.
Care must be taken since the maps off the sphere, such as the inverse Euler map 
and stereographic projection, are not invariant under rotation
(obviously, otherwise we would not need to rotate away from the pole).
% Finally, note that the maps $M$ and $M^{-1}$ are not affine invariant.
	% Obviously not affine invariant, otherwise we would not need
	% to rotate away from pole, since this would have no effect
	% on the quaternion spline shape.
That is, before we consider the issue of rotation, we need to consider the issue of
invariance under rotation.

We want our design of the quaternion spline to be invariant to rotation
(or equivalently, invariant to the coordinate frame).
In particular, if we are given two quaternion datasets that differ only by a rotation,
Q and rot(Q), we would like to generate two quaternion splines $S$ and $S'$
that differ only by this rotation: $S' = \mbox{rot}(S)$.

The solution is to impose a canonical frame of reference.
Only three points are necessary to define a unique frame of reference,
since the added degree of freedom is locked down through the points lying on \Sn{3}.
To rotate a quaternion dataset $Q = \{q_i\}_{i=0}^n$ into the canonical frame,
$q_0$ is rotated to the pole, 
then $q_1$ is rotated to the $\{x_2=0,x_3=0\}$ plane (without moving $q_0$),
and finally $q_2$ is rotated to the $\{x_3=0\}$ hyperplane
(without moving $q_0$ or $q_1$).
% Of course, this rotation is also reversed at the end.
	% This rotation to a canonical frame for coordinate-frame invariance
	% is also useful in the following heuristic method
	% (or alternatively one has to be careful to rotate eigenvectors
	% in a coordinate-frame-independent way).
	% Rotation to a canonical frame allows use of standard rotation
	% matrix with normal n to best-fitting plane as first row,
	% n x e1 as 2nd row, n x e1 x e2 as 3rd row, and 
	% n x e1 x e2 x e3 as fourth row.
	% Similarly, for the optimal method.
	% However, a random choice is not repeatable, so we do not use it. 
The algorithm is as follows:
\begin{itemize}
\item Rotate the quaternion dataset into a canonical frame (as just described).
      Let $r_1$ be the quaternion that achieves this rotation.
\item Rotate the quaternion dataset so that no quaternion is close to the pole.
      Let $r_2$ be the quaternion that achieves this rotation.
\item Build a quaternion spline S through the rotated quaternions.
\item Reverse the two initial rotations, by applying $---$.  ({\bf FILL IN}: probably $r_1^{-1} r_2^{-1}$).
\end{itemize}

The observant reader may have noticed that we have established
coordinate-frame invariance for our quaternion splines on \Sn{3},
but should actually be more interested in coordinate-frame invariance 
of the objects in 3-space that are undergoing the motion.
	% (The latter is equivalent to coordinate-frame invariance in the rotation
	% group SO(3).)
Fortunately, these invariances are equivalent, as can be seen in the following lemma.
%
\begin{lemma}
Rotation of an object in 3-space by a constant amount
is equivalent to rotation of the associated quaternion on \Sn{3}
by a constant amount.
\end{lemma}
\prf
If the original orientation of the object and the amount of
rotation are represented by the quaternions $q = (q_1,q_2,q_3,q_4)$ 
and $c = (c_1,c_2,c_3,c_4)$, respectively,
then the orientation of the object after the rotation is $c q$
and the quaternion associated with the orientation of the object
has changed from $q$ to $c q$.
Using the formula for quaternion multiplication (\ref{eq:qmult}),
notice that $c q$ can be interpreted as the rotation 
of $q$ on \Sn{3}\ by a constant amount (depending on $c$):
\[
c * q = \left( \begin{array}{cccc}
	c_1 & -c_2 & -c_3 & -c_4 \\
	c_2 &  c_1 & -c_4 &  c_3 \\
	c_3 &  c_4 &  c_1 & -c_2 \\
	c_4 & -c_3 &  c_2 &  c_1
	\end{array} \right)
	\left( \begin{array}{c}
	q_1 \\ q_2 \\ q_3 \\ q_4
	\end{array} \right)
\]
Note that this $c$ is a rotation matrix in 4-space (unit and orthogonal rows, unit and orthogonal
columns, unit determinant).
% This matrix is a rotation matrix in 4-space.
	% unit rows and columns, orthogonal rows, orthogonal columns
	% unit determinant (yes, checked)
\QED

\subsection{Rotating away from the pole}
\label{sec:polerotate}

We now discuss how the second rotation, the rotation away from the pole, 
can be accomplished.
Rotation away from the pole is equivalent to finding an empty region of the sphere \Sn{3}.
The quaternions will then be moved far away from the
pole by rotating the pole to the middle of the empty region.
There are many ways to find a point in the middle of an empty region.

% \subsection{Finding an empty region}

The optimal solution is to find
the point in the middle of the largest empty region.
{\bf Janardan claims to have a solution to this in his LM (layered manufacturing) work.}
This is a generalization of the classical largest empty circle
problem for points in a plane \cite{shamos85}, 
and a similar technique using the Voronoi diagram may be used.\footnote{Renka \cite{renka}
  has developed an algorithm for the Voronoi diagram of points on the lower-dimensional
  $S^2$.}
Let $f(p)$ be the distance of $p \in \Sn{3}$ from the nearest quaternion.
(Note that distance must be measured on the surface.)
The maximum of $f(p)$ 
is attained at some vertex of the Voronoi diagram of the quaternions on \Sn{3},
which is the desired optimal empty point.
The Voronoi diagram must be built on the surface \Sn{3}, which 
is itself an interesting problem.
Luckily, only the Voronoi vertices need to be computed,
not the entire Voronoi diagram.
A Voronoi diagram is built out of point bisectors, and
the bisector of two points on \Sn{3}\ is a great circle of \Sn{3}.
A simplistic approach is to compute a superset of the Voronoi vertices
by intersecting all bisectors of two quaternions, and then 
choose the one furthest from all quaternions.
	% O(n choose 2) = O(n^2) circles; 
	% O(n^4) intersections
	% O(n^5) distance calculations, but can abort early on many
{\bf Implement this (good student project).}

An heuristic approach can be used to find a point of an
empty region, which is not guaranteed to find an empty point, 
but usually finds a very good empty point.
The idea is to move the data far from the pole by moving the best-fitting plane
of the data as far as possible from the pole.
In particular, the unit normal of the best-fitting hyperplane 
is chosen as the empty point (FIGURE OF DATASET, ITS BESTFITTING PLANE, AND ITS NORMAL AS POINT ON SPHERE).
Since the best-fitting plane is a good representative of most of the
points, the points tend to move far away from the pole.
Of course, outliers may be moved close to the pole.
This method is efficient, since the best-fitting plane may be computed
easily using principal component analysis:
the normal of the best-fitting plane is the eigenvector associated with the
smallest eigenvalue of the covariance matrix of the data \cite{ballard82}.
% The normal of the best-fitting plane is equivalent to the vector 
% such that the projection of the data points onto this vector has minimal variance,
% i.e., the vector a that minimizes a^t \Sigma a.

A simple randomized method is also worthy of mention.
Since there are so many empty regions on \Sn{3} (see below),
even a random choice of point on \Sn{3}\ is often effective.
A point on \Sn{3}\ is chosen at random until a point in an empty region 
is found.\footnote{To find a random point on \Sn{3}, find four random numbers 
  in [-1,1] defining a 4-vector, and then normalize this vector.}
   % A random number in [-1,1] can be generated in C/C++ using the 'rand' function
   % as follows:
   % (float) (rand() \% 32767) / 16383 - 1.0.
	% That is, we could randomly choose a point on \Sn{3}, test if it is
	% sufficiently far away from all data points, and if not then randomly choose
	% another point, and so on, until a valid point in an empty region is found.
	% The density of empty regions ensures the efficiency of this method.
		% The results in Section~\ref{sec:results} support the effectiveness
		% of a random choice of empty region \ref{}.
	% How many attempts before success? on all6: 1,1,1,1,4,56
This is a very simple method.
Care must be taken with repeatability.
If given the same data twice, we would like to choose the same point in an empty region
to rotate to the pole.
Fortunately, we can take advantage of the predictability 
of pseudo-random number generators.
If a pseudo-random number generator is used with the same seed
(such as the C 'rand' function), exactly the same sequence of `random' points will be 
generated each time it is called,
leading to the same quaternion spline if the method is repeated.

EVALUATE THESE THREE METHODS EXPERIMENTALLY.

% \subsection{Existence of an empty region}
% \label{sec:empty}

The very existence of an empty region is a question worthy of examination.
Is there an empty region whose center is at least $20^{\circ}$ from the
nearest quaternion?
It is theoretically possible that the data points are so densely packed
on the sphere that there is no empty region.
However, the requisite number of data points is huge.
	% large in theory, and
\Comment{
The 'surface area' of \Sn{3} is $2\pi^2$ \cite{kendall61}
while a region 30 degrees wide about a point has area $\pi/6$.
	% A point covers a region 30 degrees wide about it, which has
	% a surface area of $\pi/6$ on the sphere \Sn{3}\ of area $2\pi^2$
	% \cite{kendall61}.
Thus, theoretically only about $12\pi \approx 38$ points are needed to
cover the sphere, leaving no empty region.\footnote{Actually, quite
	a few more points are needed, since the discs about the 38 points
	do not abut perfectly.}
However, this requires a gap of at least 60 degrees between 
consecutive quaternions, a very large change of orientation.
The typical gap between consecutive quaternions for reasonable
motion control is about 20 degrees.
	% independent of the method used to construct the quaternion spline.
}
If there is a maximum gap of $20^{\circ}$ between a quaternion and its
closest neighbour, 434,783 points\footnote{The surface area 
	of \Sn{2}\ is $4\pi$, while the surface area
	of a region on \Sn{2}\ 10 degrees wide centered about a point is 
	$\int_{0}^{2\pi} \int_0^{\frac{\pi}{18}}  \sin \phi \ d\phi \ d\theta
	= .0000289$.} % \cite{lang79}
	% Lang, Calculus of several variables, p. 228
	% p. 208 for parameterization, p. 224-5 for ||dx/dphi x dx/dtheta||
	% integral of sin is -cos
are needed to cover \Sn{2}, and even more to cover \Sn{3}.
	% In the examples of Section~\ref{sec:results}, 
	% the distance between quaternions is about --- \ref{}.
Moreover, in order to leave no empty region, the quaternions
must be spread across the entire sphere.
It is far more common for the data to be restricted to a small region
of the sphere.
Thus, there will be a valid empty region on \Sn{3} in all but the most
pathological cases (over 400,000 quaternions uniformly scattered across \Sn{3}).

% We need a data point covering every empty region of the sphere.
% Consider the number of points needed to cover just the 2-sphere \Sn{2}.
% A point on \Sn{2}\ covers a region 30 degrees wide about it,
% which has the following surface area:
% \[
%  \int_{0}^{2\pi} \int_0^{\frac{\pi}{6}}  \sin \phi \ d\phi \ d\theta
%	= .841787
% \]
% using 10 degrees or \pi/18, area is only .0000289
% which leads to 431,073 points.
% Therefore, for data sets of size 15,
% it is possible to find a point $p$ with no data points within 30
% degrees of $p$.

\Comment{
% It is certainly more difficult to find an empty region for larger datasets, and
% may even be impossible in theory (although in practice, a huge dataset is required
% for $S^3$ to have no sufficiently large empty region).
One approach is to compute the Voronoi diagram of the point set and choose
one of the Voronoi vertices, but this requires quite a bit of work
and no algorithm has presently been developed for Voronoi diagrams 
of points on $S^3$.
However, empty regions are easy to find among small point sets.
}

\subsection{Building the quaternion spline up from smaller pieces}
\label{sec:divide}

START HERE

A robust and simple method may be designed if we are willing to build many
quaternion splines independently, each using only a subset of the quaternions.
Notice that, if the dataset is partitioned into subsets $\{q_i\}_{i=0}^n$ such that
the angle between $q_0$ and every quaternion $q_i$, $i \geq 1$ is less than $\theta$
degrees (i.e., every quaternion lies in a disk of radius $\theta$ about $q_0$),
then every quaternion $q_i$ of this dataset lies at a distance of at least 180 - $\theta$
degrees from $q_0$'s antipodal point.
This means that it is simple to find an empty point:
$q_0$'s antipodal point is an empty point of a subset $\{q_i\}_{i=0}^n$ that varies
by at most 160 (150?) degrees from $q_0$.\footnote{We measure distance
  from $q_0$ so that the subset may be designed trivially.  Larger subsets
  might be built if an arbitrary quaternion was used as the pivot.}
This suggests a divide-and-conquer strategy in which the dataset is partitioned
into small sets, and a quaternion spline is built for each small set.
% assumes a maximal distance between consecutive samples
The advantage of this divide and conquer approach is that it is guaranteed yet simple.
The second and third approaches above are simple but not guaranteed.
The first approach above is guaranteed but not simple.

Here is the algorithm in a C-like syntax.
This algorithm is called recursively, but the opening call is qSpline (n, q, NIL, NIL).

\begin{verbatim}
void qSpline (int n, Quaternion *q, float openingDeriv[NDERIV][3], qSpline &QS)
{
  i=1;
  subset = {q_0};
  nSubset = 1;
  while (angle(q[0],q[i]) < 160)
   {
     subset = subset $\cup$ \{q_i\};
     i++; nSubset++;
   }
  rotate subset and derivatives so that -q[0] is moved to the pole (1,0,0,0) (or whatever the pole of the inverse map is)
  if (openingDeriv == NIL)
       design a quaternion spline S through this rotated subset
  else design a quaternion spline S through this rotated subset with these rotated opening derivatives
  
  rotate the quaternion spline back
  measure the end derivatives of S
  if (nSubset < n)
   {
    qSpline (n-nSubset, q + nSubset, end derivatives of S, QSnext)
    QS = S spliced with QSnext
   }
  if (n - nSubset == 1)
    split the last two subsets into equal sizes
}
\end{verbatim}

We assume that object orientations (quaternions) are sampled frequently enough
so that consecutive quaternions span less than 160 degrees
(so subsets are of nontrivial size).
Note that quaternions at 180 degrees represent the same orientation (Section~\ref{sec:quaternionTheory}),
so no pair of consecutive quaternions need to be more than 90 degrees apart:
if they are, the second quaternion may be replaced by its antipode.

This method does require some additional theoretical development,
since the quaternion splines for each subset will need to be spliced 
together smoothly.
In particular, we must consider the control of derivatives at the endpoints of a
quaternion spline.
This issue will be covered in the next section.

\clearpage

\section{Derivative images}
\label{sec:deriv}

\begin{lemma}
Let $C(t) = (x_1(t),x_2(t),x_3(t),x_4(t))$ be a parametric curve that lies on \Sn{3}.
The restricted inverse Euler map of $C(t)$ is another curve on \Sn{3}.
The first derivative of this curve $M^{-1}|_{S3}(C(t))$ is:
\[
(\frac{x'_2}{(2-2x_1)^{1/2}} + \frac{x'_1x_2}{(2-2x_1)^{3/2}}, 
 \frac{x'_3}{(2-2x_1)^{1/2}} + \frac{x'_1x_3}{(2-2x_1)^{3/2}},
 \frac{x'_4}{(2-2x_1)^{1/2}} + \frac{x'_1x_4}{(2-2x_1)^{3/2}},
 \frac{-x'_1}{2\sqrt{2-2x_1}})
\]
\end{lemma}
\prf
\begin{eqnarray*}
(M^{-1}(C(t))' & = & (M^{-1})'(C(t)) \cdot C'(t)
\end{eqnarray*}
Consider the first coordinate of $(M^{-1})'(C(t))$.
The second and third coordinates are computed analogously.
Recall that the restricted inverse of the Euler map is
\[
M^{-1}|_{S3}(C(t)) = \frac{(x_2,x_3,x_4,1-x_1)}{\sqrt{2-2x_1}}
\]
If we let $g(t) = (2-2x_1(t))^{\frac{1}{2}}$, then
\[
g'(t) = \frac{-x'_1}{\sqrt{2-2x_1}}
\]
and it is clear that the first coordinate of $(M^{-1})'(C(t))$ is:
\[
\frac{x'_2 \sqrt{2-2x_1} + \frac{x'_1 x_2}{\sqrt{2-2x_1}}}{2-2x_1}
= \frac{x'_2}{(2-2x_1)^{1/2}} + \frac{x'_1x_2}{(2-2x_1)^{3/2}}
% = \frac{x'_2(2-2x_1) + x'_1x_2}{(2-2x_1)^{3/2}}
% = \frac{x'_1x_2 - 2x_1x'_2 + 2x'_2}{(2-2x_1)^{3/2}}
\]
The fourth coordinate of $M^{-1}(C(t))$ is 
$\frac{1-x_1}{\sqrt{2-2x_1}} = (\frac{1-x_1}{2})^{1/2}$
and its derivative is:
\[
\frac{1}{2} (\frac{1-x_1}{2})^{-1/2}(\frac{-x'_1}{2})
= \frac{-x'_1}{2\sqrt{2-2x_1}}
\]
This yields the stated derivative.
% Collecting, the derivative of the inverse Euler map is:
% \[
% \frac{1}{\sqrt{2-2x_1}} 
% (\frac{x'_1x_2 - 2x_1x'_2 + 2x'_2}{2-2x_1},
%  \frac{x'_1x_3 - 2x_1x'_3 + 2x'_3}{2-2x_1},
%  \frac{x'_1x_4 - 2x_1x'_4 + 2x'_4}{2-2x_1},
% -\frac{x'_1}{2})
% \]
\QED

Higher derivatives are found simply by repeating this process. 
DO SO IN MAPLE.

\begin{lemma}
Let $C(t) = (x_1(t),x_2(t),x_3(t),x_4(t))$ be a parametric curve that lies on $S^3$.
The first derivative of the stereographic projection of the curve $C(t)$ is 
\[
(\frac{x^{'2}_1(1-x_4) + x_1x'_1x'_4}{(1-x_4)^2},\ 
                \frac{x^{'2}_2(1-x_4) + x_2x'_2x'_4}{(1-x_4)^2},\  
                  \frac{x^{'2}_3(1-x_4) + x_3x'_3x'_4}{(1-x_4)^2}, 0)
\]
\end{lemma}
\prf
\begin{eqnarray*}
(f_{SP}(C(t))' & = & f_{SP}'(C(t)) \cdot C'(t) \\
           & = & (\frac{x'_1(1-x_4) + x_1x'_4}{(1-x_4)^2},\ 
                  \frac{x'_2(1-x_4) + x_2x'_4}{(1-x_4)^2},\  
                  \frac{x'_3(1-x_4) + x_3x'_4}{(1-x_4)^2}, 0) 
		  \cdot (x'_1, x'_2, x'_3, x'_4) \\
           & = & (\frac{x^{'2}_1(1-x_4) + x_1x'_1x'_4}{(1-x_4)^2},\ 
                  \frac{x^{'2}_2(1-x_4) + x_2x'_2x'_4}{(1-x_4)^2},\  
                  \frac{x^{'2}_3(1-x_4) + x_3x'_3x'_4}{(1-x_4)^2}, 0)
\end{eqnarray*}
\QED

Higher derivatives are found simply by repeating this process.

\clearpage

\section{Bezier images}

START HERE NEXT

Once the quaternions $\{q_i\}$ have been mapped to free points $\{p_i\}$, 
unconstrained to the sphere,
and the $\{p_i\}$ have been interpolated by a curve $C$,
the remaining step is to map this curve back to \Sn{3}.
This section attacks the problem of mapping a Bezier curve under a rational map
to the sphere.
This yields a rational Bezier curve.

\begin{theorem}
\label{thm:imagecurve}
The image of the cubic Bezier curve $\sum_{i=0}^3 b_i B_i^3(t)$ under M 
is the sextic rational Bezier curve $\frac{\sum_{i=0}^6 w_i \breve{b}_i B_i^6(t)}
                                          {\sum_{i=0}^6 w_i B_i^6(t)}$ 
with control points:
\begin{eqnarray}
\breve{b}_0 & = & \frac{{\cal M}(b_0,b_0)}{b_0 \cdot b_0} \nonumber \\
\breve{b}_1 & = & \frac{{\cal M}(b_0,b_1) + {\cal M}(b_1,b_0)}{2b_0\cdot b_1} \nonumber \\
\breve{b}_2 & = & \frac{{\cal M}(b_0,b_2) + 3{\cal M}(b_1,b_1) + {\cal M}(b_2,b_0)}{2b_0 \cdot b_2 + 3b_1 \cdot b_1} \nonumber \\
\breve{b}_3 & = & \frac{{\cal M}(b_0,b_3) + 9{\cal M}(b_1,b_2) + 9{\cal M}(b_2,b_1) + {\cal M}(b_3,b_0)}{2b_0 \cdot b_3 + 18 b_1 \cdot b_2} \nonumber \\
\breve{b}_4 & = & \frac{{\cal M}(b_1,b_3) + 3{\cal M}(b_2,b_2) + {\cal M}(b_3,b_1)}{2b_1 \cdot b_3 + 3 b_2 \cdot b_2} \nonumber \\
\breve{b}_5 & = & \frac{{\cal M}(b_2,b_3) + {\cal M}(b_3,b_2)}{2b_2 \cdot b_3} \nonumber \\
\breve{b}_6 & = & \frac{{\cal M}(b_3,b_3)}{b_3 \cdot b_3} \nonumber
\end{eqnarray}
and weights:
\begin{eqnarray}
w_0 & = & b_0 \cdot b_0 \nonumber \\
w_1 & = & b_0 \cdot b_1 \nonumber \\
w_2 & = & \frac{2b_0 \cdot b_2 + 3b_1 \cdot b_1}{5} \nonumber \\
w_3 & = & \frac{b_0 \cdot b_3 + 9b_1 \cdot b_2}{10} \nonumber \\
w_4 & = & \frac{2b_3 \cdot b_1 + 3b_2 \cdot b_2}{5} \nonumber \\
w_5 & = & b_3 \cdot b_2 \nonumber \\
w_6 & = & b_3 \cdot b_3 \nonumber
\end{eqnarray}
Notice that ${\cal M}$ is the bilinear map of (\ref{eq:calM}).
\end{theorem}
\prf See the appendix.
\QED

\subsection{Appendix: proof of Euler map's image of a Bezier curve}

\subsubsection{Bezier derivatives}

If $b(t)$ is a rational Bezier curve of degree $n$ 
with control points $\{b_i\}_{i=0}^n$ and 
weights $\{w_i\}_{i=0}^n$ defined over $t \in [0,1]$, then 
\begin{eqnarray}
\label{eqn:firstderiv}
b'(0) & = & n \frac{w_1}{w_0} (b_1 - b_0) \\
\label{eqn:secondderiv}
b''(0) & = & \frac{n-1}{n} \frac{w_0 w_2}{w_1^2} 
             \frac{\triangle b_0 \times \triangle b_1}{\| \triangle b_0\|^3}
\end{eqnarray}
where $\triangle b_i = b_{i+1} - b_i$.
See Farin \cite{farin02} and Hoschek/Lasser \cite{hoschekLasser0?}. 
% p. 244 of HL has conditions for curvature continuity
Notice the relationship of second derivative to curvature $\kappa$:
\[
    \kappa = \|b''\|
\]
if $b$ is arc-length parameterized, and in general,
\[
    \kappa = \frac{\| b' \times b'' \|}{\| b' \|^3}
\]
$C^2$ continuity guarantees curvature continuity.
See Farin \cite{farin02} or a differential geometry text.
% the formula for curvature of a rational Bezier curve is 
% k = \frac{n-1}{n} \frac{w_0 w_2}{w_1^2} 
%     \frac{\mbox{dist}(b_0,\lyne{b_1 - b_0}}{\mbox{dist}(b_0,b_1)^2}

The product rule of Bernstein polynomials \cite{farin02} states:
\[
B_i^m(t) B_j^n(t) = \frac{\choice{m}{i} \choice{n}{j}}{\choice{m+n}{i+j}} B_{i+j}^{m+n}(t)
\]

\subsubsection{Proof of Theorem~\ref{thm:imagecurve}}

\prf
Let $c(t)$ be the cubic Bezier curve.
Since the image of $c(t)$ is a rational Bezier curve, it is easier 
to work in projective space.
In projective space, the map $M$ becomes
\[
	 (x_1,x_2,x_3,x_4,x_5) \rightarrow
	 (x_1^2 + x_2^2 + x_3^2 - x_4^2,\ 
	 2x_1 x_4,\ 2x_2 x_4,\ 2x_3 x_4,\ 
	 x_1^2 + x_2^2 + x_3^2 + x_4^2).
\]
Let the image curve be expressed in projective space: 
$M(c(t)) = (m_1(t),m_2(t),m_3(t),m_4(t),m_5(t))$.
Each coordinate $m_i(t)$ may be simplified using the product rule 
of Bernstein polynomials \cite{farin02};
consider $m_5(t)$ as an example.
\begin{eqnarray}
m_5(t) & = & [\sum_{i=0}^3 B_i^3(t) b_{i1}]^2 + 
	\ldots + [\sum_{i=0}^3 B_i^3(t) b_{i4}]^2 \nonumber \\
     & = &  \sum_{i=0}^3 \sum_{j=0}^3 
	\frac{\choice{3}{i} \choice{3}{j}}{\choice{6}{i+j}}
       B^6_{i+j}(t) (b_{i1} b_{j1} + \ldots + b_{i4} b_{j4}) \nonumber
\end{eqnarray}
Letting $k=i+j$, 
\[ m_5(t) = \sum_{k=0}^6 B_k^6(t) 
	\sum_{\begin{array}{c}  \mbox{\footnotesize{$0 \leq i \leq 3$}} \\ 
			     \mbox{\footnotesize{$0 \leq j \leq 3$}} \\ 
			     \mbox{\footnotesize{$i+j=k$}}
			     \end{array}} 
	\frac{\scriptchoice{3}{i} \scriptchoice{3}{j}}{\scriptchoice{6}{k}}
	(b_{i1} b_{j1} + \ldots + b_{i4} b_{j4}) \]
The other coordinates can be computed analogously to yield:
\[ M(c(t)) = 
   \sum_{k=0}^6 B_k^6(t)
	\sum_{\begin{array}{c}  \mbox{\footnotesize{$0 \leq i \leq 3$}} \\ 
			     \mbox{\footnotesize{$0 \leq j \leq 3$}} \\ 
			     \mbox{\footnotesize{$i+j=k$}}
			     \end{array}} 
	\frac{\choice{3}{i} \choice{3}{j}}{\choice{6}{k}}
	\left( \begin{array}{c}
            b_{i1} b_{j1} + b_{i2} b_{j2} + b_{i3} b_{j3} - b_{i4} b_{j4} \\
            2b_{i1} b_{j4} \\
            2b_{i2} b_{j4} \\
            2b_{i3} b_{j4} \\
            b_{i1} b_{j1} + b_{i2} b_{j2} + b_{i3} b_{j3} + b_{i4} b_{j4}
	\end{array} \right) \]
This is a sextic rational Bezier curve with weights 
\begin{eqnarray}
\label{eq:weights}
w_k & = & \sum_{\begin{array}{c} \mbox{\footnotesize{$0 \leq i \leq 3$}} \\ 
			     \mbox{\footnotesize{$0 \leq j \leq 3$}} \\ 
			     \mbox{\footnotesize{$i+j=k$}}
			     \end{array}}
        \frac{\choice{3}{i} \choice{3}{j}}{\choice{6}{k}}
	\ (b_{i1} b_{j1} + b_{i2} b_{j2} + b_{i3} b_{j3} + b_{i4} b_{j4}) \nonumber \\
& = & \sum_{\begin{array}{c} \mbox{\footnotesize{$0 \leq i \leq 3$}} \\ 
			     \mbox{\footnotesize{$0 \leq j \leq 3$}} \\ 
			     \mbox{\footnotesize{$i+j=k$}}
			     \end{array}}
        \frac{\choice{3}{i} \choice{3}{j}}{\choice{6}{k}}
	\ b_i \cdot b_j
\end{eqnarray}
and control points 
\begin{eqnarray}
\label{eq:control-pts}
\breve{b}_k & = & \frac{1}{w_k} 
      \sum_{\begin{array}{c} \mbox{\footnotesize{$0 \leq i \leq 3$}} \\ 
			     \mbox{\footnotesize{$0 \leq j \leq 3$}} \\ 
			     \mbox{\footnotesize{$i+j=k$}}
			     \end{array}} 
        \frac{\choice{3}{i} \choice{3}{j}}{\choice{6}{k}}
	\left( \begin{array}{c}
            b_{i1} b_{j1} + b_{i2} b_{j2} + b_{i3} b_{j3} - b_{i4} b_{j4} \\
            2b_{i1} b_{j4} \\
            2b_{i2} b_{j4} \\
            2b_{i3} b_{j4} 
	\end{array} \right) \nonumber \\
& = & \frac{1}{w_k} 
      \sum_{\begin{array}{c} \mbox{\footnotesize{$0 \leq i \leq 3$}} \\ 
			     \mbox{\footnotesize{$0 \leq j \leq 3$}} \\ 
			     \mbox{\footnotesize{$i+j=k$}}
			     \end{array}} 
        \frac{\choice{3}{i} \choice{3}{j}}{\choice{6}{k}}
{\cal M}(b_i, b_j)
\end{eqnarray}
for $k = 0, \ldots, 6$.

By evaluating (\ref{eq:weights}), $w_0$ through $w_3$ can be simplified to
\begin{eqnarray}
(w_0,w_1,w_2,w_3) & = & 
% (b_0 \cdot b_0, 
% \frac{3b_0 \cdot b_1 + 3b_1 \cdot b_0}{6}, 
% \frac{3b_0 \cdot b_2 + 9b_1 \cdot b_1 + 3b_2 \cdot b_0}{15}, 
% \frac{b_0 \cdot b_3 + 9b_1 \cdot b_2 + 9b_2 \cdot b_1 + b3 \cdot b_0}{20}) \nonumber \\
% & = &
(b_0 \cdot b_0, b_0 \cdot b_1, \frac{2b_0 \cdot b_2 + 3b_1 \cdot b_1}{5}, 
\frac{b_0 \cdot b_3 + 9b_1 \cdot b_2}{10}) \nonumber 
\end{eqnarray}

Similarly, by evaluating (\ref{eq:control-pts}), $\breve{b}_0$ through $\breve{b}_3$ 
can be simplified to 
\begin{eqnarray}
\breve{b}_0 & = & % \frac{{\cal M}(b_0,b_0)}{w_0} =
                    \frac{{\cal M}(b_0,b_0)}{b_0 \cdot b_0} \nonumber \\
\breve{b}_1 & = & % \frac{{\cal M}(b_0,b_1) + {\cal M}(b_1,b_0)}{2w_1} =
                    \frac{{\cal M}(b_0,b_1) + {\cal M}(b_1,b_0)}{2b_0\cdot b_1} \nonumber \\
\breve{b}_2 & = & % \frac{{\cal M}(b_0,b_2) + 3{\cal M}(b_1,b_1) + {\cal M}(b_2,b_0)}{5w_2} = 
                    \frac{{\cal M}(b_0,b_2) + 3{\cal M}(b_1,b_1) + {\cal M}(b_2,b_0)}
	                 {2b_0 \cdot b_2 + 3b_1 \cdot b_1} \nonumber \\
\breve{b}_3 & = & % \frac{{\cal M}(b_0,b_3) + 9{\cal M}(b_1,b_2) + 9{\cal M}(b_2,b_1) + {\cal M}(b_3,b_0)}{20w_3} =
                    \frac{{\cal M}(b_0,b_3) + 9{\cal M}(b_1,b_2) + 9{\cal M}(b_2,b_1) + {\cal M}(b_3,b_0)}{2b_0 \cdot b_3 + 18b_1 \cdot b_2} \nonumber
\end{eqnarray}

$\breve{b}_4$ through $\breve{b}_6$ and $w_4$ through $w_6$ can then be determined 
through the symmetry of Bezier curves: 
since the geometry of the cubic Bezier curve does not change 
under reversal of the control points, neither does the algebra of its image.
The leverage of symmetry also generates more efficient formulae.\footnote{For example,
  $w_6$ and $\breve{b}_6$ are both expressed originally as sums of 7 terms.
  Using symmetry, they are now expressed by one term.}
\begin{eqnarray}
w_4 & = & \frac{2b_3 \cdot b_1 + 3b_2 \cdot b_2}{5} \nonumber \\
w_5 & = & b_3 \cdot b_2 \nonumber \\
w_6 & = & b_3 \cdot b_3 \nonumber \\
\breve{b}_4 & = & \frac{{\cal M}(b_3,b_1) + 3{\cal M}(b_2,b_2) + {\cal M}(b_1,b_3)}
	                 {2b_3 \cdot b_1 + 3b_2 \cdot b_2} \nonumber \\
\breve{b}_5 & = & \frac{{\cal M}(b_3,b_2) + {\cal M}(b_2,b_3)}{2b_3\cdot b_2} \nonumber \\
\breve{b}_6 & = & \frac{{\cal M}(b_3,b_3)}{b_3 \cdot b_3} \nonumber
\end{eqnarray}
\QED

HOW ABOUT ARBITRARY BEZIER CURVE?

\begin{theorem}
\label{thm:imagesp}
The image under inverse stereographic projection 
of a cubic Bezier curve with control points $b_i = (b_{i1},\ldots,b_{i4})$
is a sextic rational Bezier curve 
with control points $\breve{b}_i = $ 
and weights $w_i = $.
This maps an arbitrary cubic curve to a curve on \Sn{3}.
\end{theorem}
\prf
Let $c(t) = \sum_{i=0}^3 b_i B_i^3(t)$ be the cubic Bezier curve.
Since the image of $c(t)$ is a rational Bezier curve,
it is easier to work in projective space.
% When $c(t)$ is expressed in projective space, it becomes
% \[
% \sum_{i=0}^3 (b_{i1},b_{i2},b_{i3},b_{i4}, 1) B_i^3(t)
% \]
In projective space, inverse perspective projection becomes
\[
f^{-1}_{SP}(x_1,x_2,x_3,0,1) = (2x_1, 2x_2, 2x_3,\ x_1^2 + x_2^2 + x_3^2 - 1, 
                                \ x_1^2 + x_2^2 + x_3^2 + 1)
\]
The fourth coordinate of the image curve may be expanded using the product rule
for Bernstein polynomials:
\begin{eqnarray*}
& [\sum_{i=0}^3 B_i^3(t) b_{i1}]^2 + 
[\sum_{i=0}^3 B_i^3(t) b_{i2}]^2 + 
[\sum_{i=0}^3 B_i^3(t) b_{i3}]^2 - 1 \\
= & \sum_{i=0}^3 \sum_{j=0}^3 
	\frac{\choice{3}{i} \choice{3}{j}}{\choice{6}{i+j}}
       B^6_{i+j}(t) (b_{i1} b_{j1} + b_{i2} b_{j2} + b_{i3} b_{j3} - 1) 
\end{eqnarray*}
Letting $k=i+j$, this becomes
\[ \sum_{k=0}^6 B_k^6(t) 
	\sum_{\begin{array}{c}  \mbox{\footnotesize{$0 \leq i \leq 3$}} \\ 
	                        \mbox{\footnotesize{$0 \leq j \leq 3$}} \\ 
			        \mbox{\footnotesize{$i+j=k$}}
			     \end{array}} 
	\frac{\scriptchoice{3}{i} \scriptchoice{3}{j}}{\scriptchoice{6}{k}}
	(b_{i1} b_{j1} + b_{i2} b_{j2} + b_{i3} b_{j3} - 1) 
\]
The fifth coordinate may be expanded analogously, yielding the weights
\[
	\sum_{\begin{array}{c}  \mbox{\footnotesize{$0 \leq i \leq 3$}} \\ 
	                        \mbox{\footnotesize{$0 \leq j \leq 3$}} \\ 
			        \mbox{\footnotesize{$i+j=k$}}
			     \end{array}} 
	\frac{\scriptchoice{3}{i} \scriptchoice{3}{j}}{\scriptchoice{6}{k}}
	(b_{i1} b_{j1} + b_{i2} b_{j2} + b_{i3} b_{j3} + 1) 
\]
The first, second, and third coordinates must be degree elevated,
from degree 3 to 6.
START HERE BY ADDRESSING DEGREE ELEVATION
\QED

% image under stereographic projection
\Comment{
\prf
Let $c(t) = \sum_{i=0}^3 b_i B_i^3(t)$ be the cubic Bezier curve.
Since the image of $c(t)$ is a rational Bezier curve,
it is easier to work in projective space.
% When $c(t)$ is expressed in projective space, it becomes
% \[
% \sum_{i=0}^3 (b_{i1},b_{i2},b_{i3},b_{i4}, 1) B_i^3(t)
% \]
Perspective projection becomes
\[
f_{SP}(x_1,x_2,x_3,x_4,1) = (x_1,x_2,x_3,0,1-x_4)
\]
% Let the image curve in projective space be $f_{SP}(c(t)) = (f_1(t),\ldots,f_5(t))$.
Note that 
\[
1 - \sum_{i=0}^3 b_{i4} B_i^3(t) = \sum_{i=0}^3 B_i^3(t) - \sum_{i=0}^3 b_{i4} B_i^3(t)
= \sum_{i=0}^3 (1-b_{i4})B_i^3(t)
\]
using the partition of unity property of Bernstein polynomials.
Therefore, 
\[
f_{SP}(c(t)) = \sum_{i=0}^3 (b_{i1}, b_{i2}, b_{i3}, 0, 1-b_{i4}) B_i^3(t)
\]
This is a cubic rational Bezier curve with weights $w_i = 1-b_{i4}$
and control points $\frac{1}{w_i} (b_{i1}, b_{i2}, b_{i3}, 0)$.
\QED
}

\clearpage

\section{Examples}

\subsection{A comparison}

We now compare the Euler map $M$ with stereographic injection.
$M$ works over a larger domain than stereographic injection ($\Re^{n+1}$
rather than $\Re^n$).
Therefore, the most we can expect is that $M$ contains some embedding of
stereographic injection.
It does: the restriction of $M$ to the hyperplane $x_{n+1}=1$
is equivalent to stereographic injection.
However, $x_{n+1}=1$ is the only hyperplane restriction that is equivalent to 
stereographic injection.
For example, the restriction of $M$ to the hyperplane $x_{n+1}=5$ is
\[
	(x_{1},\ldots,x_n) \rightarrow
	\frac{1}{x_1^2 + \cdots + x_n^2 + 25}
	(x_1^2 + \cdots + x_{n}^2 - 25, 10x_1, \ldots, 10x_n).
\]
Thus, $M$ can be characterized as an extension of stereographic injection:
its restriction to the hyperplane $x_{n+1}=1$ is equivalent
	% the hyperplane restriction $M_{x_{n+1}=1}$ is equivalent to $\sigma^{-1}$
while its behaviour on other hyperplanes of $\Re^{n+1}$ is different
from $\sigma^{-1}$.

TECH REPORT ONLY:
A comparison of $M$ and stereographic injection in projective space initially 
seems to reveal a deeper relationship between the two maps,
but this is misleading.
Translating $M$ to projective space (with projective coordinate $x_{n+2}$), 
we have
% where little changes since the terms are already homogeneous of degree 2:
\begin{equation}
\label{eq:projM}
(x_1,\ldots,x_{n+1},x_{n+2}) \mapsto 
	(x_1^2 + \cdots + x_{n}^2 - x_{n+1}^2,
	 2x_1x_{n+1}, \ldots, 2x_nx_{n+1}, x_1^2 + \cdots + x_{n+1}^2)
\end{equation}
Similarly, translating stereographic injection to projective space 
(with projective coordinate $x_{n+1}$), we have
\begin{equation}
\label{eq:projsi}
	(x_1,\ldots,x_{n+1}) \mapsto
	(x_1^2 + \cdots + x_n^2 - x_{n+1}^2,\ 2x_{1}x_{n+1}, \ldots,\ 2x_{n}x_{n+1},\ 
	x_1^2 + \cdots + x_{n+1}^2)
\end{equation}
	% These look virtually identical!
These seem to have the same relationship as embedded stereographic
injection and stereographic injection,
as every hyperplane $x_{n+2}=k$ of (\ref{eq:projM}) gets mapped 
like stereographic injection (\ref{eq:projsi}).
However, we are now dealing with the very different case of 
hyperplanes in the projective coordinate $x_{n+2}$.
Even more importantly, $x_{n+1}$ is a typical % affine?
coordinate in (\ref{eq:projM}) but the added projective coordinate in (\ref{eq:projsi}).
The interchange of projective and other coordinates is a significant
change to a map. %, unlike the minor effect of interchanging two affine coordinates.
For example, the two points $(0,0,1)$ and $(0,1,0)$ in projective 2-space
are identical except for an interchange of coordinates,
yet $(0,0,1)$ is the origin while $(0,1,0)$ is a point at infinity
along the $y$-axis.
Thus, $M$ is indeed significantly different from stereographic injection.

We conclude that the Euler map to the sphere is a powerful extension of
the inverse map of stereographic projection.

[Be careful using stereographic projection, since the conclusions of comp.tex are that
stereographic projection leads to an inferior quaternion spline.
Doesn't this imply that we have implemented the map of a Bezier curve under
stereographic projection too?]

Can also check in hermiteQ.pdf.

LATER:
There are arguments for both maps, the Euler map and the inverse of stereographic
projection, but the acid test is their use to build a quaternion spline.
We will consider both options in this paper.
Other maps can be used as well, using a development modeled after the construction
for the two maps.

\begin{itemize}
\item
We prefer a map with domain $\Re^4$, so that the data points will be
mapped to one-dimensional curves in Euclidean space and the 
curve design in Euclidean space will enjoy more flexibility.
\item
A map between $S^3$ and $\Re^3$ is more appropriate than a map between $S^3$ and $\Re^4$
for the inverse map.
The inverse will be unique, while in the latter case the map from $S^3$ to $\Re^4$ is
inherently one-to-many, since we are moving from a 3-manifold to a 4-manifold.
\end{itemize}

\section{Rotation is a different beast in 4-space}

The weaponry of rotation is intriguing, since we are working in a higher dimension.

\section{Conclusions}

Line interpolation is an interesting future research topic 
(see Section~\ref{sec:inveuler}).

\clearpage

\bibliographystyle{plain}
\begin{thebibliography}{99}

\bibitem{ballard82}
Ballard.

\bibitem{farin02}
Farin.

\bibitem{hoschekLasser0?}
Hoschek.

\bibitem{jjrm0}
Johnstone, J. (2005) Rational maps to the sphere for motion design.
Technical report, Dept. of Computer and Information Sciences, UAB, February 2005.

\bibitem{kendall61}
Kendall.

\bibitem{kreyszig59}
Kreyszig, E. (1959) Differential Geometry.
Dover (New York).

\bibitem{misner73}
C. Misner and ---.
Gravitation.

\bibitem{renka}
Renka.

\bibitem{shamos85}

\bibitem[Ballard 82]{ballard82}
Ballard, D. and C. Brown (1982)
Computer Vision.
Prentice-Hall (Englewood Cliffs, NJ).

\bibitem[Barr 92]{barr92}
Barr, A. and B. Currin and S. Gabriel and J. Hughes (1992)
Smooth Interpolation of Orientations with Angular Velocity Constraints
using Quaternions.
SIGGRAPH '92, 313--320.

\bibitem[Dickson 52]{dickson52}
Dickson, L.E. (1952) History of the Theory of Numbers: Volume II,
Diophantine Analysis.  Chelsea (New York).

\bibitem[Dietz 93]{dietz93}
Dietz, R. and J. Hoschek and B. Juttler (1993)
An algebraic approach to curves and surfaces on the sphere and
on other quadrics.
Computer Aided Geometric Design 10, 211-229.

\bibitem[Duff 85]{duff85}
Duff, T. (1985)
Quaternion splines for animating orientation.
1985 Monterey Computer Graphics Workshop, 54--62.

\bibitem[Farin 97]{farin97}
Farin, G. (1997)
Curves and Surfaces for CAGD: A Practical Guide (4th edition).
Academic Press (New York).

\bibitem[Foley 96]{foley96}
Foley, J. and A. van Dam and S. Feiner and J. Hughes (1996)
Computer Graphics: Principles and Practice (2nd edition in C).
Addison-Wesley (Reading, Massachusetts).

\bibitem[Golub 89]{golubvanloan89}
Golub, G. and C. Van Loan (1989)
Matrix Computations.
2nd edition, Johns Hopkins University Press (Baltimore).

\bibitem[Goldstein 50]{goldstein50}
Goldstein, H. (1950)
Classical Mechanics.
Addison-Wesley (Reading, Massachusetts).

\bibitem[Harris 92]{harris92}
Harris, J. (1992)
Algebraic Geometry: A First Course.
Springer-Verlag (New York).

\bibitem[Hart 94]{hart94}
Hart, J. and G. Francis and L. Kauffman (1994)
Visualizing Quaternion Rotation.
ACM Transactions on Graphics 13(3), July, 256--276.

\bibitem[Herstein 75]{herstein75}
Herstein, I. (1975) Topics in Algebra.
2nd edition, John Wiley (New York).

\bibitem[Hoschek 92]{hoschekSeemann92}
Hoschek, J. and G. Seemann (1992)
Spherical splines.
Mathematical Modeling and Numerical Analysis, 26(1), 1--22.

\bibitem[Johnstone and Williams 95]{jjjw95}
Johnstone, J. and J. Williams (1995)
Rational Control of Orientation for Animation.
{\em Graphics Interface '95}, Quebec City, 179--186.

\bibitem[Johnstone 99b]{jj98b}
Johnstone, J.K. (1999)
The Most Natural Map to the $n$-sphere.
Manuscript.
Available at http://www.cis.uab.edu/info/faculty/jj/cos.html.

\bibitem[Kendall 61]{kendall61}
Kendall, M.G. (1961)
A Course in the Geometry of n Dimensions.
Charles Griffin (London).

\bibitem[Kim 95]{kim95}
Kim, M.-J. and M.-S. Kim and S. Shin (1995)
A General Construction Scheme for Unit Quaternion Curves
with Simple Higher Order Derivatives.
SIGGRAPH '95, 369--376.

\bibitem[Kreyszig 63]{kreyszig63}
Kreyszig, E. (1963)
Differential Geometry.
Dover (New York).

\bibitem[Lang 79]{lang79}
Lang, S. (1979)
Calculus of Several Variables, 2nd edition.
Addison-Wesley (Reading, Mass).

\bibitem[Misner 73]{misner73}
Misner, C. and K. Thorne and J. Wheeler (1973)
Gravitation.
W.H. Freeman (San Francisco).

\bibitem[Nam 95]{nam95}
Nam, K.-W. and M.-S. Kim (1995)
Hermite interpolation of solid orientations based on a smooth blending
of two great circular arcs on SO(3).
Proc. of CG International '95.

\bibitem[Nielson 92]{nielson92}
Nielson, G. and R. Heiland (1992)
Animated rotations using quaternions and splines on a 4D sphere.
Programming and Computer Software, 145--154.

\bibitem[Nielson 93]{nielson93}
Nielson, G. (1993)
Smooth interpolation of orientations.
In Models and Techniques in Computer Animation, Springer-Verlag (New York),
75--93.

\bibitem[Park 95]{park95}
Park, F. and B. Ravani (1995)
Bezier Curves on Riemannian Manifolds and Lie Groups with
Kinematics Applications.
Transactions of the ASME 117, 36--54.

\bibitem[Park 97]{park97}
Park, F. and B. Ravani (1997)
Smooth Invariant Interpolation of Rotations.
ACM Transactions on Graphics 16(3), 277--295.

\bibitem[Pletinckx 89]{pletinckx89}
Pletinckx, D. (1989) 
Quaternion calculus as a basic tool in computer graphics.
The Visual Computer 5, 2--13.

\bibitem[Popovic 99]{popovic99}
Popovic, Z. and A. Witkin (1999)
Physically Based Motion Transformation.
SIGGRAPH '99, 11--20.

\bibitem[Ramamoorthi 97]{rama97}
Ramamoorthi, R. and A. Barr (1997)
Fast Construction of Accurate Quaternion Splines.
SIGGRAPH '97, Los Angeles, 287--292.

\bibitem[Schlag 91]{schlag91}
Schlag, J. (1991) Using geometric constructions to interpolate
orientation with quaternions.  In Graphics Gems II, Academic Press (New York),
377--380.

\bibitem[Preparata 85]{shamos85}
Preparata, F. and M. Shamos (1985)
Computational Geometry: An Introduction.
Springer-Verlag (New York).

\bibitem[Shoemake 85]{shoemake85}
Shoemake, K. (1985) Animating rotation with quaternion curves.
SIGGRAPH '85, San Francisco, 19(3), 245--254.

\bibitem[Thorpe 79]{thorpe79}
Thorpe, J. (1979)
Elementary Topics in Differential Geometry.
Springer-Verlag (New York).

\bibitem[Wang 93]{wang93}
Wang, W. and B. Joe (1993)
Orientation Interpolation in Quaternion Space using Spherical Biarcs.
Graphics Interface '93, 24--32.

\bibitem[Wang 94]{wang94}
Wang, W. (1994)
Rational Spherical Curves.
Technical Report, Dept. of Computer Science, University of Hong Kong.

\bibitem[Witkin 88]{witkin88}
Witkin, A. and M. Kass (1988)
Spacetime Constraints.
Computer Graphics 22(4) (Proc. SIGGRAPH '88), 159--168.

% \bibitem[Woo 97]{opengl97}
% Woo, M. and J. Neider and T. Davis (1997)
% OpenGL Programming Guide (2nd edition).
% Addison-Wesley Developers Press (Reading, Mass.),
% pp. 464-8.

\end{thebibliography}

CREATE BIB FILE.

\clearpage

\section{Appendix}
\label{sec:appendix}

\subsection{Proof of Lemma~\ref{lem:inverse}}

\prf
We work in projective space $P^4$, where the map $M$ becomes
\begin{equation}
\label{eq:proj}
	 M(x_1,x_2,x_3,x_4,x_5) =
	 (x_1^2 + x_2^2 + x_3^2 - x_4^2,\ 
	 2x_1 x_4,\ 2x_2 x_4,\ 2x_3 x_4,\ 
	 x_1^2 + x_2^2 + x_3^2 + x_4^2).
\end{equation}
Let $p = (p_1,p_2,p_3,p_4,1) \in S^3 \subset P^4$.
We want to determine the conditions on $q = (q_1,q_2,q_3,q_4,q_5) \in P^4$
so that $M(q_1,q_2,q_3,q_4,q_5) = p$.
Suppose that $M(q_1,q_2,q_3,q_4,q_5) = p$.
Using (\ref{eq:proj}) and (\ref{eq:projequivalence}), we have
\begin{equation}
\label{eq1}
	q_1^2 + q_2^2 + q_3^2 - q_4^2 = kp_1
\end{equation}
\begin{equation}
\label{eq2}
	2q_1q_4	= kp_2
\end{equation}
\begin{equation}
\label{eq3}
	2q_2q_4	= kp_3
\end{equation}
\begin{equation}
\label{eq4}
	2q_3q_4	= kp_4
\end{equation}
\begin{equation}
\label{eq5}
	q_1^2 + q_2^2 + q_3^2 + q_4^2 = k
\end{equation}
for some $k \neq 0$.
$q_5$ is arbitrary, since it does not appear in these equations.
Subtracting (\ref{eq1}) from (\ref{eq5}), 
we have $2q_4^2 = k(1 - p_1)$
or 
\begin{equation}
\label{eq:q4}
q_4 = \pm \sqrt{\frac{k(1-p_1)}{2}}
\end{equation}
%
{\bf Case 1:\ }
Suppose $p_1 = 1$. Then $p = (1,0,0,0,1)$ since $p \in \Sn{3}$.
$q_4 = 0$ by (\ref{eq:q4})
and $M(q) = (q_1^2 + q_2^2 + q_3^2, 0, 0, 0, q_1^2 + q_2^2 + q_3^2)
       = (1,0,0,0,1)$ for any values of $q_1,q_2,q_3$, not all zero.
That is, $M(q) = p$ if and only if $q \in H$ where $H$ is 
the hyperplane $x_4 = 0$ minus the origin.
Equivalently, $M^{-1}(p) = H$.
This is the special behaviour at the pole.\\
%
{\bf Case 2:\ }
Suppose $p_1 \neq 1$.
Then $p_1 < 1$ since $p \in \Sn{3}$. 
From (\ref{eq:q4}), $q_4 \neq 0$ and $q_4$ is a real number.
From (\ref{eq2}-\ref{eq4}), $q_i = \frac{kp_{i+1}}{2q_4}$ for $i=1,2,3$.
% \[
%	q = (\frac{kp_2}{2q_4}, \frac{kp_3}{2q_4}, \frac{kp_4}{2q_4}, q_4, q_5)
% \]
By the properties of projective space, 
\[
	q = \frac{2q_4}{k} q
	  = (p_2, p_3, p_4, \frac{2q_4^2}{k},\frac{2q_4q_5}{k})
\]
then using (\ref{eq:q4}),
\[
	q = (p_2,p_3,p_4,1-p_1, \pm \sqrt{\frac{2(1-p_1)}{k}} q_5)
\]
Since $q_5$ and $k \neq 0$ are arbitrary,
\[
	q = (p_2,p_3,p_4,1-p_1, k') \hspace{1in} k' \in \Re
\]
We have shown that $M(q) = p$ only if 
$q = (p_2,p_3,p_4,1 - p_1,k')$.

On the other hand, if $q = (p_2,p_3,p_4,1 - p_1,k')$, $k' \in \Re$
and $p_1 \neq 1$,
then 
\[
\scriptsize{M(q) = (p_2^2 + p_3^2 + p_4^2 - (1 - p_1)^2,\ 
	2p_2 (1 - p_1),\ 2p_3 (1 - p_1),\ 2p_4 (1 - p_1),\ 
	p_2^2 + p_3^2 + p_4^2 + (1 - p_1)^2).}
\]
Using $p_1^2 + p_2^2 + p_3^2 + p_4^2 = 1$,
\[
M(q) = (2p_1(1 - p_1),\ 2p_2 (1 - p_1),\ 2p_3 (1 - p_1),\ 2p_4 (1 - p_1),\ 
2(1 - p_1))
\]
or $M(q) = (p_1,p_2,p_3,p_4,1)$ using (\ref{eq:projequivalence}).
Thus, $M(q) = p$ if and only if 
$q = (p_2,p_3,p_4,1 - p_1,k')$, $k' \in \Re$.
Translating back from projective space,
$M(q) = p$ if and only if 
$q = t(p_2,p_3,p_4, 1-p_1)$, $t \neq 0 \in \Re$.
% Equivalently, $M^{-1}(p) = t(p_2,p_3,p_4, 1-p_1)$, $t \neq 0 \in \Re$.
It is understandable that the preimage does not contain the origin, 
since $M$ is undefined there.
\QED
% $q \in M^{-1}(p)$ if and only if $M(q) = p$.

\subsection{Closest point vs. point on \Sn{3}}

In this section, we establish that the choice of $p_i$ as the point on \Sn{3}
(Section~\ref{sec:inveuler})
is a good approximation to the closest point to $p_{i-1}$.
Consider two unit quaternions $q_1 = (a,b,c,d)$ and $q_2 = (A,B,C,D)$.
Let $\epsilon$ be their difference in $x_1$-coordinate and $\theta$
be the angle between $q_1$ and $q_2$.
Consider the difference between the choice of inverse image as closest point $p_2$
and point $p_2'$ on \Sn{3} (Figure~\ref{fig:QQdist}).
The distance between $p_2$ and $p_2'$ is $1-\cos \alpha$, where
$\alpha$ is the angle between the inverse image lines $M^{-1}(q_1)$ and
$M^{-1}(q_2)$ (see Figure~\ref{fig:QQdist} again).
$\cos \alpha$ can be reexpressed as follows:
\[
	\cos \alpha = \frac{(b,c,d,1-a)}{\sqrt{2-2a}}
	\cdot
	\frac{(B,C,D,1-A)}{\sqrt{2-2A}}
	= \frac{\cos \theta + 1 - a - A}
	       {2\sqrt{1-a-A+aA}}
\]
since $\cos\theta = (a,b,c,d) \cdot (A,B,C,D)$.
Reexpressing $A$ as $a + \epsilon$,
\[
\cos \alpha = \frac{\cos \theta + 1 - 2a - \epsilon}
	       {2\sqrt{1-2a-\epsilon+a^2 + \epsilon a}}
	= \frac{\cos \theta + 1 - 2a - \epsilon}
	       {2\sqrt{(1-a-\frac{\epsilon}{2})^2 - \frac{\epsilon^2}{4}}}
\]
Suppose that $\frac{\epsilon^2}{4}$ is very small and can be ignored,
and that $\theta$ is small so that $\cos \theta$ is close to 1.
This is true if the quaternion data is densely sampled.
Then 
\[
\cos \alpha \approx \frac{2 - 2a - \epsilon}{2(1-a-\frac{\epsilon}{2})} = 1,\ \ 
1-\cos \alpha \approx 0
\]
and the distance between $p_2$ and $p_2'$, $1 - \cos\alpha$, is small.  
We conclude that the choice of $p_i$ as the 'point on \Sn{3}'
is a good approximation to the choice of $p_i$ as the closest point to $p_{i-1}$,
especially when the quaternion data is densely sampled.

\begin{figure}
\vspace{2.5in}
\special{psfile=/usr/people/jj/modelTR/3-spline/img/EulerRotThm.ps
	 hoffset=150}
\caption{Any change of orientation can be expressed as a rotation about a fixed axis}
% file: EulerRotThm.showcase
% tops EulerRotThm.rgb -m 6.5 1.5 > EulerRotThm.ps
\label{fig:eulerRotation}
\end{figure}

\begin{figure}
\vspace{2.5in}
\special{psfile=/usr/people/jj/modelTR/3-spline/img/dist1-cosAlpha.ps
	 hoffset=150}
\caption{The distance between $p_2$ and $p_2'$ is $1-\cos\alpha$}
% file: dist1-cosAlpha.showcase
% tops dist1-cosAlpha.rgb -m 6.5 1.5 > dist1-cosAlpha.ps
\label{fig:QQdist}
\end{figure}

\begin{figure}[ht]
\begin{center}
% \includegraphics[scale=.25]{img/fig:stereo.jpg}
\end{center}
\caption{Stereographic projection in 3-space}
\label{fig:stereo}
\end{figure}

\begin{figure}[h]
\vspace{3in}
% \special{psfile=/usr/people/jj/modelTR/3-spline/img/unstable.ps hoffset=80}
\caption{Unstable behaviour near the pole (cusp is directly at pole) and its correction}
\label{fig:wild}
% s3spline -m 90 -p < data3-cusp &
% s3spline -m 90    < data3-cusp &
% tops unstable.rgb -m 8.5 2 > unstable.ps
\end{figure}

\end{document}
